<!doctype html>
<!--<html lang="en">-->
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <link rel="shortcut icon" href="img/isbfavicon.ico" type="image/x-icon"/>
    <meta charset="utf-8"/>
    <!--<meta name="viewport" content="width=1024">-->
    <meta name="viewport" content="initial-scale=1.0, width=device-width, height=device-height, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>QED: Atlas</title>

    <link rel="stylesheet" href="css/app.css">
    <script src="js/vendor.js"></script>
    <script src="js/app.js"></script>
    <script>require("initialize");</script>
</head>

<body>

<div class="navbar-fixed-top">
    <div class="navbar" id="navigation-container"></div>

    <ul class="atlas-navigator nav nav-list">
        <li><a href="#" onclick="return false;" class="zoom-home"> <i class="icon-home"/></i> </a></li>
        <li><a href="#" onclick="return false;" class="zoom-in"> <i class="icon-zoom-in"/></i> </a></li>
        <li><a href="#" onclick="return false;" class="zoom-out"> <i class="icon-zoom-out"/></i> </a></li>
        <li><a href="#" onclick="return false;" class="resize-item"> <i class="icon-resize-full"/></i> </a></li>
        <li><a href="#" onclick="return false;" class="scale-item"> <i class="icon-fullscreen"/></i> </a></li>
        <li><a href="#" onclick="return false;" class="refresh-loaded"> <i class="icon-refresh"/></i> </a></li>
    </ul>

    <ul class="nav nav-pills cancer-selector"></ul>

    <div class="pull-right">
        <input class="genes-typeahead" type="text" placeholder="Add a gene..."/>
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" onclick="return false;"> <i class="icon-list"></i> </a>
        <ul class="dropdown-menu gene-selector">
            <li><a href="#" onclick="return false;" class="item-remover" data-id="TP53">TP53 <i class="icon-trash"></i> </a></li>
            <li><a href="#" onclick="return false;" class="item-remover" data-id="CTCF">CTCF <i class="icon-trash"></i> </a></li>
        </ul>
    </div>
</div>

<div class="atlas-body">
    <div class="atlas-canvas">
        <div class="atlas-zoom">
            <div class="atlas-map" style="top: 50px; left: 100px;" data-scale="100">
                <h5><a href="#" onclick="return false;">Mutations</a></h5>

                <div class="map-contents container-fluid" data-source="lookups/qed_lookups/mutations" data-view="seqpeek_mini">SeqPeek (mini)</div>
            </div>

            <div class="atlas-map load-first" style="top: 20px; left: 400px;" data-scale="100">
                <h5><a href="#mutsig_grid" onclick="return false;">MutSig Ranks</a></h5>

                <div class="map-contents container-fluid" data-source="domains/mutations/mutsig_rankings" data-view="mutsig_grid">MutSig (mini)</div>
            </div>

            <div class="atlas-map" style="top: 900px; left: 1600px;" data-scale="100">
                <h5><a href="#" onclick="return false;" class="load-stacks">StacksVis</a></h5>

                <div class="map-contents container-fluid" data-source="domains/newMerge.05nov/annotated_features" data-view="stacksvis" data-lowercase="true">StacksVis (mini)</div>
            </div>

            <div class="atlas-map" style="top: 150px; left: 450px;" data-scale="100">
                <h5><a href="#" onclick="return false;">Copy Number (GISTIC)</a></h5>

                <div class="map-contents container-fluid" data-source="domains/newMerge.05nov/annotated_features">Linear Browser (mini)</div>
            </div>

            <div class="atlas-map load-first" style="top: 200px; left: 750px;" data-scale="100"
                 data-source="domains/newMerge.05nov/all_pairs" data-view="xfeaturegrid_small">
                <h5>Multi-Feature <a href="#xfeaturegrid" class="load-map" onclick="return false;">(detail)</a></h5>
                <div class="map-contents container-fluid" data-source="domains/newMerge.05nov/all_pairs" data-view="xfeaturegrid_small"></div>
            </div>

            <div class="atlas-map" style="top: 400px; left: 50px;" data-scale="100">
                <h5><a href="#" onclick="return false;">Literature Search (Pubcrawl)</a></h5>

                <div class="map-contents container-fluid" data-source="pubcrawl/search" data-view="pubcrawl_histogram">Histograms</div>
            </div>

            <div id="circ" class="atlas-map" style="top: 500px; left: 550px;" data-scale="100" data-source="analysis/pairwise_newMerge.05nov/brca.newMerge.05nov.TP.NCI.pwpv" data-view="circ">
                <h5><a href="#circ" class="load-map" onclick="return false;">Associations (PairWise)</a></h5>

                <div class="map-contents container-fluid" data-source="analysis/pairwise_newMerge.05nov/brca.newMerge.05nov.TP.NCI.pwpv" data-view="circ"></div>
            </div>

            <div class="atlas-map" style="top: 400px; left: 1000px;" data-scale="100">
                <h5><a href="#" onclick="return false;">Samples</a></h5>

                <div class="map-contents container-fluid" data-source="domains/newMerge.05nov/annotated_features" data-view="circlepack"></div>
            </div>

            <div id="xfeaturegrid" class="atlas-map load-first" style="top: 20px; left: 1100px;" data-scale="100">
                <h5>Multi-Feature <a href="#" onclick="return false;">(summary)</a></h5>
                <div class="map-contents container-fluid" data-source="domains/newMerge.05nov/all_pairs" data-view="xfeaturegrid" data-linked="#seqpeek"></div>
            </div>

            <div id="seqpeek" class="atlas-map load-first" style="top: 1200px; left: 100px;" data-scale="100">
                <h5>SeqPeek</h5>
                <div class="map-contents container-fluid" data-source="domains/mutations/Protein_Mutations_Per_Cancer_Type" data-view="seqpeek"></div>
            </div>

            <div class="atlas-map load-first" style="top: 20px; left: 1600px;" data-scale="100">
                <h5>Scatterplot</h5>
                <div class="map-contents container-fluid" data-source="domains/newMerge.05nov/annotated_features" data-view="scatterplot" data-lowercase="true"></div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var atlas;
    $(function () {
        var Atlas = require("lib/atlas");
        atlas = new Atlas($(".atlas-body"));

        var currentZoomLevel = 1.0;

        var loadFirst = function() {
            _.each($(".atlas-map.load-first"), function(atlasMap) {
                var mapcontents = $(atlasMap).find(".map-contents");
                atlas.navigate(mapcontents);
            });
        };

        var readyContainerFn = function() {
            $(".atlas-zoom").draggable({ "scroll": true });
            $(".atlas-map").draggable({ "scroll": true });
            $(".gene-selector").sortable();
            $(".cancer-selector").sortable();
        };

        qed.Events.on("ready", readyContainerFn);
        qed.Events.on("ready", loadFirst);
        
        $(".refresh-loaded").click(loadFirst);

        $(".zoom-in").click(function() {
            currentZoomLevel += 0.20;
            atlas.zoom(currentZoomLevel);
        });

        $(".zoom-out").click(function() {
            currentZoomLevel -= 0.20;
            if (currentZoomLevel < 0.01) currentZoomLevel = 0.01;
            atlas.zoom(currentZoomLevel);
        });

        $(".zoom-home").click(function() {
            currentZoomLevel = 1.0;
            atlas.zoom(currentZoomLevel);
        });

        $(".resize-item").click(function() {
            var li = $(this).parent();
            if (li.hasClass("active")) {
                $(".atlas-map").resizable("destroy");
            } else {
                $(".atlas-map").resizable({ "ghost": true});
            }
            li.toggleClass("active");
        });

        $(".scale-item").click(function() {
            var li = $(this).parent();
            if (li.hasClass("active")) {
                $(".atlas-map").resizable("destroy");
            } else {
                $(".atlas-map").resizable({
                    "handles": "n, e, s, w, ne, se, sw, nw",
                    "aspectRatio": true,
                    "animateEasing": "linear",
                    "stop": function(e, ui) {
                        var scaleLevel = (ui.size.width/ui.originalSize.width) * 90;
                        $(e.target).children().effect("scale", {"scale":"both", "percent":scaleLevel}, 1000);
                    }
                });
            }
            li.toggleClass("active");
        });

        $(".load-map").click(function(e) {
            var loadmap = $(e.target).attr("href");
            var mapcontents = $(loadmap).find(".map-contents");
            atlas.navigate(mapcontents);
        });
        $(".load-stacks").click(function(e) {
            var loadmap = $(e.target).parents(".atlas-map");
            var mapcontents = $(loadmap).find(".map-contents");
            atlas.navigate(mapcontents);
        });
    });
</script>

<!--these scripts are to support lightweight google hangout integration, should not affect how the app runs outside of hangout-->
<!--<script src="//hangoutsapi.talkgadget.google.com/talkgadget/apps/gadgets/js/rpc.js"></script>-->
<!--<script src="//hangoutsapi.talkgadget.google.com/hangouts/api/hangout.js?v=1.0"></script>-->

</body>
</html>

